use ContractIndexer files-target/simple-2.txt

setup-fixture

setup

teardown

var Mock<IRabbitMqProvider> _queue

def void SetUpMoq(AutoMock mock)
	_queue = new Mock<IRabbitMqProvider>
	provide IFileSystem new MockFileSystem
	mock IXmlParser setup ParseContractXml("good") returns new Contract
	{
		Id = new Contract.ContractId
		{
			RegistratonNumber = "п-1",
			Version = 1
		},
		PurchaseNumber = "123"
	}
	mock IXmlParser setup ParseContractXml("bad") throws Exception
	mock IHelpers setup GetDateTimePath(any-DateTime) returns @"01\01\01"
	mock ISettings setup LocalContractsPath returns @"C:\test\"
	mock IRabbitMqService setup GetInstance(any-string, any-string, -1, null) returns _queue.Object

test ProcessContractXml_NewGoodXml_Process
	SetUpMoq(mock)
	act("good")
	mock IMongoRepository verify Save(any-string,any-Contract,any-string) called once
	_queue verify Publish(any-string) called once
	mock ISender verify SendContractToApi(any-string) called once
	mock ILogHelper verify Info(any-string,any-string) called once

